<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="main.css">
    <title>Upload a File</title>
</head>


<body>
    <div class="userdetails">
        <div id="divmyUser"></div>
    </div>


    <div class="upload_group">

        <progress value="0" max="100" id="uploader">0%</progress>
        <input type="file" value="upload" id="fileButton">

    </div>

    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyCO5nuoZBW3idxnAoHRPwPD6x7ij8VZClQ",
            authDomain: "media-web-app.firebaseapp.com",
            databaseURL: "https://media-web-app.firebaseio.com",
            projectId: "media-web-app",
            storageBucket: "media-web-app.appspot.com",
            messagingSenderId: "903277250172",
            appId: "1:903277250172:web:d7030b891d67d611f5ebf9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        // START OF UPLOAD IMAGES

        // this is to get elements
        var uploader = document.getElementById('uploader');
        var fileButton = document.getElementById('fileButton');
        var myUser = document.getElementById('uid');

        // "listen" for file selection
        fileButton.addEventListener('change', function(e) {
            //myUser which has the users id code is identifying as a div element which we need to turn back into its original form
            var identity = divmyUser.innerHTML;
            // Get the file
            var file = e.target.files[0];
            //var identity = document.getElementById('uid');
            // Create a storage ref to find file again

            //need to set myUser as something before using it here IMPORTANT!!
            var storageRef = firebase.storage().ref("images/" + identity + file.name); //         images/uid/pic.png

            // Upload the file
            var task = storageRef.put(file);

            // Update the progress bar
            task.on('state_changed',

                function progress(snapshot) {
                    var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploader.value = percentage;
                },
                function error(err) {
                    window.alert('Error');
                },
                function complete() {
                    window.alert('Your File was Succesfully Uploaded!')

                }

            );

            //START OF DISPLAY IMAGES

            //i think this just lists all images, now i need to display them or atleast have a place for the list to freakin go            

            // Create a reference under which you want to list
            var listRef = storageRef.child('images/' + identity + "/");

            // Find all the prefixes and items.
            listRef.listAll()
                .then((res) => {
                    res.prefixes.forEach((folderRef) => {
                        // All the prefixes under listRef.
                        // You may call listAll() recursively on them.
                    });
                    res.items.forEach((itemRef) => {
                        // All the items under listRef.
                    });
                }).catch((error) => {
                    // Uh-oh, an error occurred!
                    window.alert('Error420 hehe')
                });
        });
        // END OF UPLOAD IMAGES

    </script>
    <script src="index.js"></script>
    <script src="auth.js"></script>
</body></html>